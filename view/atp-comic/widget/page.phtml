<?php $this->appendJs("/atp-comic/js/comic.js")?>
<?php $this->appendCss("/css/atp-comic/comic.less")?>

<div class="comic-page-widget">

    <?php if($this->siteParam("comic-show-nav-links-top")) { ?>
		<?=$navLinks?>
	<?php } ?>

	<img class="comic-img" src="<?=$this->basePath($node->page->filePath('image_file'))?>" />

    <h1 class="page-name">
        Page <?=$node->pageNumber?>: <?=$node->page->title?><br/>
        <em><?=date('F j\<\s\u\p\>S\<\/\s\u\p\>, Y', strtotime($node->page->postDate))?></em>
        <?=$this->facebookLike("comic/{$node->arc->url}/{$node->pageNumber}/{$node->page->url}")?>
    </h1>
    <?php if(strlen($node->page->transcriptHtml) > 0) { ?>
        <script>var showTranscripts=<?=$this->siteParam('comic-show-transcripts')?>;</script>
        <div id="transcript-container">
            <h2 id="transcriptToggle">
                <span>Transcript</span>
                <i class="glyphicon glyphicon-subtitles"></i>
            </h2>
            <div id="transcript">
                <?=$node->page->transcriptHtml?>
            </div>
        </div>
    <?php } ?>

	<?php if($this->siteParam("comic-show-nav-links-bottom")) { ?>
		<?=$navLinks?>
	<?php } ?>

    <div class="comic-page-footer">
        <div class="page-extra">
			<?php foreach($node->page->commentaries() as $commentary) { ?>
				<div class="commentary">
					<h2><i class="avatar-<?=$commentary->user->username?>"></i><?=$commentary->title?></h2>
					<div class="body"><?=$commentary->commentaryHtml?></div>
				</div>
			<?php } ?>
        </div>
    </div>

    <?php if($this->siteParam("comic-use-adsense")) { ?>
        <div class="ad-container">
            <div class="adsense adsense-comic-page"><?=$this->adsense("inline-ad")?></div>
        </div>
    <?php } ?>

    <?php if($showComments) { ?>
        <div id="disqus_thread" class="col-xs-12"></div>
        <script>
            var disqus_config = function () {
                this.page.url = "http://<?=$_SERVER['SERVER_NAME'] . $this->url('comic/page', $node->getRoutingData())?>";
                this.page.identifier = "<?=md5($_SERVER['SERVER_NAME'] . $this->url('comic/page', $node->getRoutingData()))?>";
            };

            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');
                s.src = '//darkwynd-chronicles.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <?php } ?>
</div>